version: 2.1

orbs:
  win: circleci/windows@4.1.1

jobs:

  deploy_windows:
    parameters:
      label:
        type: string
        default: main
    executor:
      name: win/default
      shell: bash.exe
    steps:
      - checkout
      - run:
          name: Install conda-build/anaconda-client
          command: |
            conda update conda
            conda install -y -q conda-build anaconda-client
            conda config --set anaconda_upload yes
      - run:
          name: Build packages
          environment:
            PACKAGE_TYPE: <<parameters.label>>
          command: |
            cd conda
            conda build faiss --user pytorch --label <<parameters.label>> -c pytorch

workflows:
  version: 2
  build:
    jobs:
      - deploy_windows:
          name: Windows packages
          